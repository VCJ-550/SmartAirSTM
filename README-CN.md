# 										涂鸦智能 七合一空气盒子

​																																																								——作者：VCJ

​																								**仅供个人学习使用，不得用于任何商业用途！！！**



基本功能全部测试通过，全部正常，功能全部实现了，电路除运放部分放大倍数设计过高外，其余电路都正常（V2版已修正）。

​    PCB布局上涂鸦模组使用带IPEX接口的模组，不插天线没有射频出来，需要插上射频天线（V2版已修正）。

代码共享在GitHub，文末有链接，附件中只提供固件。

 

### 成品效果图：



为了方便调试，面板没有贴。

 ![1](https://i.loli.net/2021/03/10/eGXBqzpsaMPv9j6.jpg)

### 电路板实物：

![2](https://i.loli.net/2021/03/10/OU6EQrqbtD7l9NM.jpg)

​               **元件面**

 


 ![3](https://i.loli.net/2021/03/10/JwHOeC6dRsaMzQN.jpg)

​                                                                                                                     **屏幕面**

## **一、功能概述：**
1、支持检测C02、温度、湿度、光照度、甲醛、PM2.5、噪声。
2、带2.8寸TFT触摸屏，支持彩色显示和触控。
3、支持电池供电，使用3.7V锂离子电池。
4、支持电池电量检测，过充、过放、低压保护。
5、带蜂鸣器，可做检测报警使用。
6、带一键开机电路，正常情况下，关机时，锂电池只会有几微安电流。
7、支持LCD背光调节。


## **二、设计功能：**
1、用户操作界面
	实现与用户交互的机的操作界面（比如：滑屏、参数设置、参数查看等）。
2、云服务
	直接采用涂鸦云，提供云服务，可以在手机端随时查看盒子检测参数。
3、电源管理
	在插入电源、不插电源、电池电量不足等情况，控制不同电路工作情况，在特定状态下维持盒子稳定工作。
4、智能警告
当某一项检测值超标时，通过蜂鸣器报警，同时屏幕显示具体报警项。用户可以通过按键解除报警。

 

## **三、功能实现**

1、用户界面分为主界面、详情页面、设置页面、信息页面。

  1）主界面主要显示几个重要的检测数据（PM1、PM2.5、PM10、温湿度、甲醛、二氧化碳）的实际参数。主页面带天气和日历功能，可显示当前所在城市发布的天气信息。

  2）详情页面，这个页面可以显示所有传感器的数据，数据实时更新。

  3）设置页面：这个页面可以修改控制盒子的一些参数（比如：温标、校对时间、重置WIFI等）。

  4）信息页面：这个页面可以显示盒子的运行信息以及作者相关的信息。

2、云服务

  选用涂鸦的wbr1d模组，直接上涂鸦云，关于模块，V1版中选用的模块不带ipex接口，因为是安装在盒子里面，建议选用带IPEX插座的模组，信号好一点。

3、电源管理

  通过开机键可以开启/关闭盒子电源，实现开关机。同时盒子正常运行后，按键还可以作为普通按键使用，一键多用。

  内置3.7V 2000mAh锂离子充电电池，板子上做有电源管理和升压电路，可实现充电管理、电池供电、电源+电池、单电源供电、电池过放保护等功能。

  带有电池电量监测，根据电量的变化，调整盒子的功耗，保护电池不会损坏。

  内置锂电池升压电路，升压效率高，损耗低，输出功率高。


## **四、外壳和传感器**
外壳使用共模外壳，外观差一点。

![4](https://i.loli.net/2021/03/10/PvAZ41tIfnr5cgk.png)

由于外壳是共模外壳，所以安装时，有的地方尺寸有点不合适，但是在接受范围内。

 


传感器采用现成模块。如下：
粉尘传感器，型号：PMS7003，精度高，稳定，功耗也还算低。

![5](https://i.loli.net/2021/03/10/eDTSA7CUdgzIs5h.png)

 

甲醛传感器，型号：DART WZ-S，精确度高，功耗也不高。只是上电后要等一段时间才有数据返回。

![6](https://i.loli.net/2021/03/10/OVDmA5BNc1bXGiK.png)



二氧化碳传感器，型号T6703-5K，精度高，功耗不高，要注意检测口不要沾染杂物和污渍。

   个人觉得，这个模块还是应该引出排线，不然焊在板子上太占位置了，也不好拆。

![7](https://i.loli.net/2021/03/10/NmXAyonGFdgKaWM.png)

 

## **五、说明**

1、程序采用固件库写的，代码在不断更新，修补BUG。

2、盒子用到了LCD屏，支持汉字显示和图片显示，由于要显示汉字和图片，所以要有汉字库和图片库（用到的图），

字库和图库都是存在外部Flash（W25Q128）中，如果W25Q128中没有图库和字库，盒子不能正常运行。

3、字库和图库是在下载盒子程序时，随STM32程序一并写入的，原理是通过MDK加载STM32外部SPI Flash编程算法对W25Q128进行编程，

只需编程一次，后续不用再修改W25Q128内部数据，修改单片机程序任意部分都不会影响W25Q128内部的字库和图库数据（整片擦除 除外）。

4、显示屏用的电阻屏，相对电容屏，触摸反应迟钝一点，容易检测错误，所以操作时不要点太快。

5、字库和图库下载方法请参考附件中的说明。

6、PCB开源和演示视频:[立创开源平台-涂鸦智能七合一空气盒子](https://oshwhub.com/VCJ123/tu-ya-zhi-neng-wen-shi-du-he-zi)

 